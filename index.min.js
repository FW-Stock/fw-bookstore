function logout(){firebase.auth().signOut(),document.location.href="login",localStorage.setItem("FW_loginChecked","false"),localStorage.setItem("FW_emailUser",null)}$(document).ready((function(){null==localStorage.getItem("FW_emailUser")&&"true"!==localStorage.getItem("FW_anonymous")&&(firebase.auth().currentUser.delete(),logout())})),$(".l_filter_bar_responsive").click((function(){press=1,"none"===$("#filter_bar").css("display")&&$("#filter_bar").css("display","inherit")})),$(".l_filter_bar").click((function(){press=1,$(document).width()<=992&&"block"===$("#filter_bar").css("display")&&$("#filter_bar").css("display","none")}));var width,list_sub,list_cat,list_form,press=0;function all(t,e){for(let i=0;i<$(t).length;i++)$(t).eq(i)[0].checked=$(e)[0].checked;$(e)[0].checked||$(".card_html").html("")}setInterval((function(){width!==$(document).width()?width>992?($("#filter_bar").css("display","inherit"),press=0):0===press&&$("#filter_bar").css("display","none"):width>992&&$("#filter_bar").css("display","inherit"),width=$(document).width()}),10),$(".c_box").change((function(){1==$("#s_0")[0].checked&&1==$("#c_0")[0].checked&&1==$("#f_0")[0].checked&&initial(),this===$("#s_0")[0]||this===$("#c_0")[0]||this===$("#f_0")[0]?(all(".c_box_sub","#s_0"),all(".c_box_cat","#c_0"),all(".c_box_form","#f_0")):select(this)}));var storage_filter=[];function select(t){let e;list_sub=[],list_cat=[],list_form=[],storage_filter=[],e=$(t).is(".c_box_sub")?"sub":$(t).is(".c_box_cat")?"cat":"form";for(let t=0;t<$(".c_box_"+e).length;t++)$(".c_box_"+e).eq(t)[0].checked&&window["list_"+e].push($(".c_box_"+e).eq(t).parent().children("label").text());"sub"===e?filter("subject",list_sub):"cat"===e?filter("category",list_cat):filter("level",list_form)}function filter(t,e){""!=e?db.collection("Item").where("filter."+t,"in",e.slice(0,10)).get().then((async i=>{await i.forEach((t=>{storage_filter.push(t.id)})),e.length>10&&await db.collection("Item").where("filter."+t,"in",e.slice(10,e.length)).get().then((t=>{t.forEach((t=>{storage_filter.push(t.id)}))})),card_html="";for(let t=0;t<storage_filter.length;t++)await db.collection("Item").doc(storage_filter[t]).get().then((async t=>{db.collection("Mods-Item").doc(t.id).get().then((e=>{void 0===e.data().Info_log&&(storage_item=t.data(),card_html+='<div class="col-xl-3 col-lg-4 col-md-6 col-sm-10"><div class="card item_card" id="'+t.id+'" onclick="item(\''+t.id+'\')"><div class="card-img-top img" style="background-image: url(\''+storage_item.photo+'\');"></div><div class="card-body"><h5 class="card-title l_item_name">'+storage_item.name+'</h5><p class="card-text l_price">RM <span class="no_price">'+storage_item.price.aft.toFixed(2)+"</span></p>","NaN"!==storage_item.price.ori.toFixed(2)&&"0.00"!==storage_item.price.ori.toFixed(2)&&(card_html+='<p class="card-text"><span class="l_ori_price">RM <span class="no_oriPrice">'+storage_item.price.ori.toFixed(2)+"</span></span>","NaN"!==((storage_item.price.ori-storage_item.price.aft)/storage_item.price.ori*100).toFixed(0)&&(card_html+=' (<span class="l_discount"><span class="no_discount">'+((storage_item.price.ori-storage_item.price.aft)/storage_item.price.ori*100).toFixed(0)+"</span>%</span> Discount)"),card_html+="</p>"),card_html+='<p class="card-text text-muted" id="l_name_'+t.id+'"></p></div></div></div>',$(".card_html").html(card_html))})).catch((t=>{console.log("Error getting document Mods Item:",t)}))})).catch((t=>{console.log("Error getting collection Item:",t)}));""==storage_filter&&$(".card_html").html("")})):$(".card_html").html("")}var storage_item,uid,storage_user,db=firebase.firestore(),card_html="";function initial(){card_html="",db.collection("Item").get().then((async t=>{await t.forEach((t=>{db.collection("Mods-Item").doc(t.id).get().then((e=>{db.collection("Mods-Users").doc(t.data().ownerID).get().then((i=>{if(i.data().seller&&void 0===e.data().Info_log){storage_item=t.data();let e=t.id;db.collection("Users").doc(storage_item.ownerID).get().then((t=>{$("#l_name_"+e).text(t.data().name)})).catch((t=>{console.log("Error getting collection Item:",error)})),card_html+='<div class="col-xl-3 col-lg-4 col-md-6 col-sm-10"><div class="card item_card" id="'+t.id+'" onclick="item(\''+t.id+'\')"><div class="card-img-top img" style="background-image: url(\''+storage_item.photo+'\');"></div><div class="card-body"><h5 class="card-title l_item_name">'+storage_item.name+'</h5><p class="card-text l_price">RM <span class="no_price">'+storage_item.price.aft.toFixed(2)+"</span></p>","NaN"!==storage_item.price.ori.toFixed(2)&&"0.00"!==storage_item.price.ori.toFixed(2)&&(card_html+='<p class="card-text"><span class="l_ori_price">RM <span class="no_oriPrice">'+storage_item.price.ori.toFixed(2)+"</span></span>","NaN"!==((storage_item.price.ori-storage_item.price.aft)/storage_item.price.ori*100).toFixed(0)&&(card_html+=' (<span class="l_discount"><span class="no_discount">'+((storage_item.price.ori-storage_item.price.aft)/storage_item.price.ori*100).toFixed(0)+"</span>%</span> Discount)"),card_html+="</p>"),card_html+='<p class="card-text text-muted" id="l_name_'+t.id+'"></p></div></div></div>',$(".card_html").html(card_html)}})).catch((t=>{console.log("Error getting document Mods Users:",t)}))})).catch((t=>{console.log("Error getting document Mods Item:",t)}))}))})).catch((t=>{console.log("Error getting collection Item:",t)}))}function item(t){document.location.href="item?id="+t}function profile(){document.location.href="profile?id="+uid}initial(),firebase.auth().onAuthStateChanged((async t=>{t&&(uid=t.uid,db.collection("Users").doc(uid).get().then((async t=>{t.exists?(storage_user=t.data(),$("#b_user").children("i").attr("class",""),$("#i_profile").attr("src",storage_user.photo)):(console.log("No such document!"),$("#i_profile").css("display","none"))})).catch((t=>{console.log("Error getting document Users",t)})))}));
