function filter_sent(){"all"===$("#c_sent")[0].value?initial():db.collection("Users").where("sent","==",JSON.parse($("#c_sent")[0].value)).get().then((e=>{table_verify="",e.forEach((e=>{show_verifying(e)}))}))}function filter_validated(){"all"===$("#c_validated")[0].value?initial():db.collection("Mods-Users").where("validated","==",JSON.parse($("#c_validated")[0].value)).get().then((e=>{table_verify="",e.forEach((e=>{console.log(e.data()),show_verifying(e)}))}))}function filter_seller(){"all"===$("#c_seller")[0].value?initial():db.collection("Mods-Users").where("seller","==",JSON.parse($("#c_seller")[0].value)).get().then((e=>{table_verify="",e.forEach((e=>{console.log(e.data()),show_verifying(e)}))}))}$("#b_back").click((function(){0===document.referrer.indexOf(location.protocol+"//"+location.host)&&history.length>1?window.history.back():document.location.href="../"}));var db=firebase.firestore(),table_verify;function initial(){table_verify="",db.collection("Users").get().then((async e=>{await e.forEach((async e=>{await show_verifying(e)}))})).catch((e=>{console.log("Error getting collection Users:",e)}))}initial();var list_mods_uid=[],uid,uid_param_var;async function show_verifying(e){await db.collection("Mods-Users").doc(e.id).get().then((async t=>{storage_user_param=e.data(),table_verify+='<tr><td id="name_verify_'+e.id+'">'+storage_user_param.name+'</td><td><a id="email_verify_'+e.id+'" href="mailto:'+storage_user_param.email+'" target="_blank">'+storage_user_param.email+"</a></td>",void 0!==storage_user_param.contact?(table_verify+='<td><a href="',"messenger"===storage_user_param.contact.provider||"instagram"==storage_user_param.contact.provider?table_verify+=storage_user_param.contact.link:"whatsapp"===storage_user_param.contact.provider?table_verify+="https://api.whatsapp.com/send?phone="+storage_user_param.contact.link:table_verify+="mailto:"+storage_user_param.contact.link,table_verify+='" target="_blank">'+storage_user_param.contact.provider+"</a></td>"):table_verify+="<td>-</td>",table_verify+='<td><a href="../profile/?id='+t.id+'" target="_blank">'+t.id+'</a><br><button type="button" class="bt b_disable" onclick="disable(\''+t.id+"')\">Disable Account</button></td>",storage_user_param.sent?table_verify+='<td><i class="fa-solid fa-check"></i></td>':table_verify+='<td><i class="fa-solid fa-xmark"></i>',storage_user_mods=t.data(),storage_user_mods.validated?(table_verify+='<td><i class="fa-solid fa-check"></i><p>at '+new Date(1e3*storage_user_mods.Info_validated.time.seconds).toLocaleString()+'<br>by <span class="l_uid_'+storage_user_mods.Info_validated.uid+'"></span><br>uid: (<a href="../profile/?id='+storage_user_mods.Info_validated.uid+'" target="_blank">'+storage_user_mods.Info_validated.uid+"</a>)</p></td>",list_mods_uid.push(storage_user_mods.Info_validated.uid)):(table_verify+='<td><i class="fa-solid fa-xmark"></i>',storage_user_param.sent&&(table_verify+="<br>Waiting . . ."),table_verify+="</td>"),storage_user_mods.seller?table_verify+='<td><i class="fa-solid fa-check"></i><br>':(table_verify+='<td><i class="fa-solid fa-xmark"></i>',storage_user_mods.validated&&(table_verify+="<br><p>"+storage_user_mods.Info_seller.reason+"</p>")),storage_user_param.sent&&(table_verify+='<button type="button" name="button" class="bt b_profile" onclick="verifyUID(\''+e.id+"', '"+storage_user_mods.seller+"', '"+storage_user_mods.validated+"')\">Edit</button>"),table_verify+="</td></tr>",$("#table_verify").html(table_verify);for(let e=0;e<list_mods_uid.length;e++)db.collection("Users").doc(list_mods_uid[e]).get().then((t=>{$(".l_uid_"+list_mods_uid[e]).text(t.data().name)})).catch((e=>{console.log("Error getting Users document: "+e)}))})).catch((e=>{console.log("Error getting document Mods-Users")}))}function initial2(){let e="";db.collection("Item").get().then((async t=>{let o,a,s,i;await t.forEach((async t=>{await db.collection("Users").doc(t.data().ownerID).get().then((async n=>{await db.collection("Mods-Item").doc(t.id).get().then((async r=>{o=t.data(),a=n.data(),s=r.data(),e+="<tr><td>"+o.name+'<br>(uid: <a href="../item/?id='+t.id+'" target="_blank">'+t.id+'</a>)<img src="'+o.photo+'" class="img_check"></td><td><a id="email_item_'+t.id+'" href="mailto:'+a.email+'" target="_blank">'+a.email+"</a></td>",void 0!==a.contact?(e+='<td><a href="',"messenger"===a.contact.provider||"instagram"==a.contact.provider?e+=a.contact.link:"whatsapp"===a.contact.provider?e+="https://api.whatsapp.com/send?phone="+a.contact.link:e+="mailto:"+a.contact.link,e+='" target="_blank">'+a.contact.provider+"</a></td>"):e+="<td>-</td>",e+='" target="_blank">'+a.contact.provider+"</a></td><td>"+new Date(1e3*o.uploaded.seconds).toLocaleString()+'</td><td><button type="button" class="bt b_edit mb-2" onclick="edit(\''+t.id+'\')" target="_blank">Edit</button><button type="button" class="bt b_suspend" onclick="suspend(\''+t.id+"', this)\"",void 0!==s.Info_log?("Suspended"===s.Info_log.action?e+='style="background-color: #03993A;">Approve':"Validating"===s.Info_log.action?e+='style="background-color: #865A8D;">Validate':e+=">Suspend",e+="</button></td><td>"+s.Info_log.action+' by <span id="mods'+t.id+'"></span><br>(uid: <a href="../profile/?id='+s.Info_log.uid+'" target="_blank">'+s.Info_log.uid+"</a>)<br>at "+new Date(1e3*s.Info_log.time.seconds).toLocaleString()+"<br>"+s.Info_log.reason+"</td></tr>"):e+=">Suspend</button></td><td></td>",$("#table_check").html(e),void 0!==s.Info_log&&db.collection("Users").doc(s.Info_log.uid).get().then((o=>{i=o.data(),$("#mods"+t.id)[0].innerText=i.name,e=$("#table_check").html()})).catch((e=>{console.log("Error getting Users document: "+e)}))})).catch((e=>{console.log("Error getting document Mods-Item: "+e)}))})).catch((e=>{console.log("Error getting document Mods-Item: "+e)}))}))})).catch((e=>{console.log("Error getting collection Item:",e)}))}function profile(){document.location.href="../profile?id="+uid}function disable(e){}function verifyUID(e,t,o){$("#verify_agreement").css("display","block"),JSON.parse(t)&&$(".btn-success").addClass("disabled"),!JSON.parse(t)&&JSON.parse(o)&&$(".btn-warning").addClass("disabled"),uid_param_var=e}function close_declare(){$(".overlay").css("display","none"),$(".btn-success").removeClass("disabled"),$(".btn-warning").removeClass("disabled")}function allow(){$(".btn-success").addClass("disabled"),swal({icon:"warning",dangerMode:!0,buttons:!0,position:"top-end",text:"This action can affect the experience of the users.",title:"Are you sure you want to add this user as a seller?"}).then((isConfirm=>{db.collection("Mods-Users").doc(uid_param_var).set({validated:!0,seller:!0,Info_validated:{time:firebase.firestore.FieldValue.serverTimestamp(),uid:uid},Info_seller:{reason:"Approved seller"}},{merge:!0}).then((()=>{console.log("Document successfully written Mods-User!"),db.collection("AppSecret").doc("Email").get().then((doc=>{Email.send({Host:doc.data().Host,Username:doc.data().From,Password:doc.data().Password,To:$("#email_verify_"+uid_param_var).text(),From:doc.data().From,Subject:"Upgraded to Seller Account in FW Bookstore",Body:eval(doc.data().Body.verifyUser)}).then((function(e){console.log("Mail sent successfully!"),$(".overlay").css("display","none"),$(".btn-success").removeClass("disabled"),$(".btn-warning").removeClass("disabled"),setTimeout((function(){document.location.reload()}),500)}))}))}))}))}function disallow(){$(".btn-danger").addClass("disabled"),swal({icon:"warning",dangerMode:!0,buttons:!0,content:{element:"input",attributes:{placeholder:"Reason"}},position:"top-end",text:"This action can affect the experience of the users. Please state the reason of removing this user from FW Bookstore Seller List clearly in the textbox below.",title:"Are you sure you want to remove the status of this user as a seller?"}).then((isConfirm=>{isConfirm?db.collection("Mods-Users").doc(uid_param_var).set({validated:!0,seller:!1,Info_validated:{time:firebase.firestore.FieldValue.serverTimestamp(),uid:uid},Info_seller:{reason:isConfirm}},{merge:!0}).then((()=>{console.log("Document successfully written Mods User!"),db.collection("AppSecret").doc("Email").get().then((doc=>{console.log(doc.data()),console.log($("#email_verify_"+uid_param_var).text()),Email.send({Host:doc.data().Host,Username:doc.data().From,Password:doc.data().Password,To:$("#email_verify_"+uid_param_var).text(),From:doc.data().From,Subject:"FW Bookstore Seller Account Status is Removed",Body:eval(doc.data().Body.removeSeller)}).then((function(e){console.log("Mail sent successfully!"),$(".overlay").css("display","none"),$(".btn-success").removeClass("disabled"),$(".btn-warning").removeClass("disabled"),setTimeout((function(){document.location.reload()}),500)}))}))})):$(".x").removeClass("disabled")}))}function edit(docItemID){swal({icon:"warning",dangerMode:!0,buttons:!0,content:{element:"input",attributes:{placeholder:"Reason"}},position:"top-end",text:"This action can affect the experience of the users. Please state the reason of editing this item. \n\nAn email from donotreply.fwbookstore@gmail.com will be automatically sent to the owner of the item. The content includes the moderator name, the time and the reason the item was edited. You will redirect to the studio page to edit the items.",title:"Are you sure you want to edit this item?"}).then((isConfirm=>{isConfirm&&db.collection("Mods-Item").doc(docItemID).set({Info_log:{action:"Edited",reason:isConfirm,time:firebase.firestore.FieldValue.serverTimestamp(),uid:uid}},{merge:!0}).then((()=>{console.log("Document successfully written Mods Item!"),db.collection("Item").doc(docItemID).get().then((docI=>{db.collection("AppSecret").doc("Email").get().then((doc=>{console.log(doc.data()),Email.send({Host:doc.data().Host,Username:doc.data().From,Password:doc.data().Password,To:$("#email_item_"+docItemID).text(),From:doc.data().From,Subject:"Your Item in FW Bookstore was Edited",Body:eval(doc.data().Body.editItem)}).then((function(e){console.log("Mail sent successfully!"),document.location.href="../studio/?action=edit&id="+docItemID}))}))}))}))}))}function suspend(docItemID,component){"Suspend"===$(component).text()?swal({icon:"warning",dangerMode:!0,buttons:!0,content:{element:"input",attributes:{placeholder:"Reason"}},position:"top-end",text:"This action can affect the experience of the users. Please state the reason of suspending this item. Suspended item will not be seen by public except the owner and FW Bookstore moderators.\n\nAn email from donotreply.fwbookstore@gmail.com will be automatically sent to the owner of the item. The content includes the moderator name, the time and the reason the item was suspended.",title:"Are you sure you want to suspend this item?"}).then((isConfirm=>{isConfirm&&db.collection("Mods-Item").doc(docItemID).set({Info_log:{action:"Suspended",reason:isConfirm,time:firebase.firestore.FieldValue.serverTimestamp(),uid:uid}},{merge:!0}).then((()=>{console.log("Document successfully written Mods Item!"),db.collection("Item").doc(docItemID).get().then((docI=>{db.collection("AppSecret").doc("Email").get().then((doc=>{console.log(doc.data()),Email.send({Host:doc.data().Host,Username:doc.data().From,Password:doc.data().Password,To:$("#email_item_"+docItemID).text(),From:doc.data().From,Subject:"Your Item in FW Bookstore was Suspended",Body:eval(doc.data().Body.suspendItem)}).then((function(e){console.log("Mail sent successfully!"),initial2(),swal({title:"The item is successfully suspended!",text:"Suspended item will not be seen by public except the owner and FW Bookstore moderators.",icon:"success",button:"Close",position:"top-end"})}))}))}))}))})):swal({icon:"warning",dangerMode:!0,buttons:!0,position:"top-end",text:"This action can affect the experience of the users. By enabling this item, the item is removed from Suspended List in FW Bookstore. \n\nAn email from donotreply.fwbookstore@gmail.com will be automatically sent to the owner of the item.",title:"Are you sure you want to approve this item?"}).then((isConfirm=>{isConfirm&&db.collection("Mods-Item").doc(docItemID).set({Info_log:firebase.firestore.FieldValue.delete()},{merge:!0}).then((()=>{db.collection("Item").doc(docItemID).get().then((docI=>{db.collection("AppSecret").doc("Email").get().then((doc=>{console.log(doc.data()),Email.send({Host:doc.data().Host,Username:doc.data().From,Password:doc.data().Password,To:$("#email_item_"+docItemID).text(),From:doc.data().From,Subject:"Your Item in FW Bookstore was Approved",Body:eval(doc.data().Body.enableItem)}).then((function(e){console.log("Mail sent successfully!"),console.log("Document successfully written Mods Item!"),initial2(),swal({title:"The item is successfully approved!",text:"Approved item will be seen by public.",icon:"success",button:"Close",position:"top-end"})}))}))}))}))}))}function hide(e){"block"===$(e).parent().parent().parent().children().eq(1).css("display")?($(e).children().addClass("fa-up-right-and-down-left-from-center"),$(e).children().removeClass("fa-down-left-and-up-right-to-center"),$(e).attr("title","Show"),$(e).parent().parent().parent().children().eq(1).css("display","none")):($(e).children().addClass("fa-down-left-and-up-right-to-center"),$(e).children().removeClass("fa-up-right-and-down-left-from-center"),$(e).attr("title","Hide"),$(e).parent().parent().parent().children().eq(1).css("display","block"))}function disable(e){swal({icon:"warning",dangerMode:!0,buttons:!0,position:"top-end",text:"This action can affect the experience of the users. Please be informed that disabled user cannot login to their account and the seller status of the user (if applicable) will be removed. \n\n Only developer has the right to disable user. Please report this issue to the developer Lim Wen Hao by stating the reason of disabling user (ID: "+e+")",title:"Disable User"})}initial2(),firebase.auth().onAuthStateChanged((async e=>{e&&(uid=e.uid,db.collection("Mods-Users").doc(uid).get().then((e=>{e.exists?e.data().mods||(document.location.href="../404.html"):(console.log("No such document!"),document.location.href="../404.html")})).catch((e=>{console.log("Error getting document Users",e),document.location.href="../404.html"})),db.collection("Users").doc(uid).get().then((async e=>{e.exists?(storage_user=e.data(),$("#b_user").children("i").attr("class",""),$("#i_profile").attr("src",storage_user.photo)):console.log("No such document!")})).catch((e=>{console.log("Error getting document Users",e)})))}));
