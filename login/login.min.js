var uid,db=firebase.firestore();function mode(){"Login"===$(".l_login").text()?($(".t_register").html('<div class="l_name mb-2"><i class="fa-solid fa-user t_fa"></i><input class="t_input" type="text" name="name" placeholder="Full Name" id="t_name"></div>'),$(".l_x_important").eq(0).removeClass("mt-5"),$(".l_x_important").eq(0).addClass("mt-2"),$(".l_login").text("Register"),$(".l_x_important").eq(1).html('Already have an account? Sign In <a class="link_red" href="javascript: mode()">Here</a>')):($(".t_register").html(""),$(".l_x_important").eq(0).removeClass("mt-2"),$(".l_x_important").eq(0).addClass("mt-5"),$(".l_login").text("Login"),$(".l_x_important").eq(1).html('Haven\'t registered? Sign Up <a class="link_red" href="javascript: mode()">Here</a>'))}function login(){if(""!==$("#t_email")[0].value&&""!==$("#t_pw")[0].value)if(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test($("#t_email")[0].value)){var e=$("#t_email")[0].value,t=$("#t_pw")[0].value;firebase.auth().signInWithEmailAndPassword(e,t).then((e=>{alert("Login successfully!","success"),localStorage.setItem("FW_anonymous",!1);e.user;localStorage.setItem("FW_loginChecked",$("#c_login")[0].checked),localStorage.setItem("FW_emailUser",$("#t_email")[0].value),setTimeout((function(){document.location.href="../introduction"}),200)})).catch((e=>{alert(e.code+": "+e.message,"danger")}))}else alert("Please fill in your email address in correct format.","warning");else alert("Please fill in the all the blanks.","warning")}function register(){if(""!==$("#t_name")[0].value&&""!==$("#t_email")[0].value&&""!==$("#t_pw")[0].value)if(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test($("#t_email")[0].value)){var e=$("#t_email")[0].value,t=$("#t_pw")[0].value;firebase.auth().createUserWithEmailAndPassword(e,t).then((e=>{e.user;uid=firebase.auth().currentUser.uid,console.log(uid),db.collection("Users").doc(uid).set({name:$("#t_name")[0].value,email:$("#t_email")[0].value,sent:!1}).then((()=>{console.log("Document successfully written!"),alert("Register successfully! Please re-login to verify your account.","success"),mode()})).catch((e=>{console.error("Error writing document: ",e)})),db.collection("Mods-Users").doc(uid).set({seller:!1,validated:!1,mods:!1},{merge:!0}).then((()=>{console.log("Document successfully written!")})).catch((e=>{console.error("Error writing document: ",e)}))})).catch((e=>{"Register"===$(".l_login").text()&&("auth/email-already-in-use"===e.code?alert("Email is already in use.","warning"):"auth/weak-password"===e.code?alert("Weak password.","warning"):alert(e.code+": "+e.messagee,"danger"))}))}else alert("Invalid email.","warning");else alert("Please fill in the all the blanks.","warning")}function anonymous(){firebase.auth().signInAnonymously().then((()=>{alert("Successfully login anonymously!","success"),localStorage.clear(),localStorage.setItem("FW_anonymous",!0),localStorage.setItem("FW_loginChecked",!1),localStorage.setItem("FW_emailUser",null),document.location.href="../introduction"})).catch((e=>{alert(e.code+": "+e.message,"danger")}))}function authentication(e){e.credential.accessToken;var t=e.user;let a=e.additionalUserInfo.profile.email;uid=firebase.auth().currentUser.uid,e.additionalUserInfo.isNewUser?(db.collection("Users").doc(uid).set({name:t.displayName,email:a,photo:t.photoURL,sent:!1}).then((()=>{console.log("Document New User successfully written!"),alert("Login successfully!","success"),localStorage.setItem("FW_anonymous",!1),localStorage.setItem("FW_loginChecked",!0),localStorage.setItem("FW_emailUser",a),setTimeout((function(){document.location.href="../introduction"}),200)})).catch((e=>{console.error("Error writing document: ",e)})),db.collection("Mods-Users/").doc(uid).set({seller:!1,validated:!1,mods:!1},{merge:!0}).then((()=>{console.log("Document successfully written!")})).catch((e=>{console.error("Error writing document: ",e)}))):(alert("Login successfully!","success"),localStorage.setItem("FW_anonymous",!1),localStorage.setItem("FW_loginChecked",!0),localStorage.setItem("FW_emailUser",a),setTimeout((function(){document.location.href="../introduction"}),200))}function google(){var e=new firebase.auth.GoogleAuthProvider;e.addScope("profile"),e.addScope("email"),firebase.auth().signInWithPopup(e).then((e=>{authentication(e)})).catch((e=>{e.email,e.credential;alert(e.code+":"+e.message,"danger")}))}function fb(){var e=new firebase.auth.FacebookAuthProvider;firebase.auth().signInWithRedirect(e),firebase.auth().signInWithRedirect(e),$("body").html("Loading . . .")}function submit(){"Login"===$(".l_login").text()?login():register()}function alert(e,t){var a=document.createElement("div");a.innerHTML='<div class="alert alert-'+t+' alert-dismissible d-flex align-items-center mt-2" role="alert"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></svg>'+e+'<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>',$("#liveAlertPlaceholder").append(a)}$(document).ready((function(){"true"===localStorage.getItem("FW_loginChecked")?(alert("Login successfully!","success"),localStorage.setItem("FW_anonymous",!1),localStorage.setItem("FW_emailUser",$("#t_email")[0].value),document.location.href="../"):localStorage.setItem("FW_loginChecked","false")})),"register"===new URLSearchParams(window.location.search).get("mode")&&mode(),firebase.auth().getRedirectResult().then((e=>{authentication(e)})),$("body").keypress((function(e){"Enter"===e.key&&submit()}));
