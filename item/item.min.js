var storage_item,storage_user_param,uid,db=firebase.firestore(),card_html="",param=new URLSearchParams(window.location.search),id=param.get("id"),touch=!1;function share(){navigator.clipboard.writeText(document.location.href),swal({title:"Link copied to clipboard!",text:"Share it to your friends!",type:"success",confirmButtonText:"Close",position:"top-end"})}function contact(e,t){"email"===e?window.open("mailto:"+t,"_blank"):"messenger"===e||"instagram"===e?window.open(t,"_blank"):"whatsapp"===e?window.open("https://api.whatsapp.com/send?phone="+t,"_blank"):alert("Loading . . .")}function enlarge(e){touch&&($(".image_enlarge").css("backgroundImage",$("#"+e.id).css("backgroundImage")),$(".image_enlarge").css("visibility","visible"),$(".image_enlarge").css("z-index","50"))}function profile(){document.location.href="../profile?id="+uid}null!==id?db.collection("Item").doc(id).get().then((async e=>{if(e.exists){if(storage_item=e.data(),$("meta").eq(2).attr("content",storage_item.name),$("meta").eq(3).attr("content",storage_item.description),$("meta").eq(4).attr("content",storage_item.photo),$("title").text(storage_item.name),db.collection("Users").doc(storage_item.ownerID).get().then((async e=>{storage_user_param=e.data(),card_html='<h5 class="card-title l_item_name mb-0">'+storage_item.name+'</h5><p class="card-text l_filter"><span class="l_subject">'+storage_item.filter.subject+'</span>, <span class="l_category">'+storage_item.filter.category+'</span>, <span class="l_level">'+storage_item.filter.level+'</span></p><p class="card-text l_x_important_data l_details mb-3">',""!==storage_item.publisher&&(card_html+='<span class="l_publisher">'+storage_item.publisher+"</span> &nbsp;&nbsp;&nbsp; "),""!==storage_item.pages&&(card_html+='<span class="l_no_pages">'+storage_item.pages+"</span> pages</p>"),card_html+='<p class="card-text l_price mb-0">RM <span class="l_no_price">'+storage_item.price.aft.toFixed(2)+'</span></p><p class="card-text l_price_aft">',"NaN"!==storage_item.price.ori.toFixed(2)&&"0.00"!==storage_item.price.ori.toFixed(2)&&(card_html+='<span class="l_ori_price">RM <span class="l_no_oriPrice">'+storage_item.price.ori.toFixed(2)+"</span></span>","NaN"!==((storage_item.price.ori-storage_item.price.aft)/storage_item.price.ori*100).toFixed(0)&&(card_html+=' (<span class="l_discount"><span class="l_no_discount">'+((storage_item.price.ori-storage_item.price.aft)/storage_item.price.ori*100).toFixed(0)+"</span>%</span> Discount)"),card_html+="</p>"),""!==storage_item.description&&(card_html+='<p class="card-text l_description">'+storage_item.description+"</p>"),card_html+='<div class="share_box"><p class="card-text l_x_important_data mb-0"><span class="l_updated_edited">Uploaded</span> on <span class="l_timestamp">'+new Date(1e3*storage_item.uploaded.seconds).toLocaleString()+'</span></p><p class="card-text l_x_important_data">by <span class="l_owner"><a href="../profile?id='+storage_item.ownerID+'">'+storage_user_param.name+'</a></span></p><button type="button" name="button" id="b_share" onclick="share()"><i class="fa-light fa-share-nodes"></i></button></div><button type="button" name="button" id="b_contact" onclick="contact(\''+storage_user_param.contact.provider+"', '"+storage_user_param.contact.link+'\')"><i class="font_awesome"></i> Contact the Owner</button>',$(".card_html").html(card_html),void 0!==storage_item.edited&&($(".l_updated_edited").text("Edited"),$(".l_timestamp").text(new Date(1e3*storage_item.uploaded.seconds).toLocaleString())),"email"===storage_user_param.contact.provider?($(".font_awesome").addClass("fa-solid"),$(".font_awesome").addClass("fa-envelope")):"messenger"===storage_user_param.contact.provider?($(".font_awesome").addClass("fa-brands"),$(".font_awesome").addClass("fa-facebook-messenger")):"instagram"===storage_user_param.contact.provider?($(".font_awesome").addClass("fa-brands"),$(".font_awesome").addClass("fa-instagram")):"whatsapp"===storage_user_param.contact.provider&&($(".font_awesome").addClass("fa-brands"),$(".font_awesome").addClass("fa-whatsapp"))})).catch((e=>{console.log("No such document User Param:"+e)})),$(".img").css("background-image","url('"+storage_item.photo+"')"),void 0!==storage_item.image_collection)for(let e=0;e<storage_item.image_collection.length;e++)$(("#img_"+e).toString()).css("background-image","url("+storage_item.image_collection[e]+")"),$(("#img_"+e).toString()).css("visibility","visible");else $(".image_collection").css("display","none");document.querySelectorAll(".detail-view").forEach((function(e){var t=window.getComputedStyle(e,!1).backgroundImage.slice(4,-1).replace(/['"]/g,""),a=new Image;a.onload=function(){if(void 0===window.ontouchmove){var t=a.naturalWidth,o=a.naturalHeight/t;e.onmousemove=function(a){var s=e.clientWidth,i=(a.pageX-this.offsetLeft)/(s/100)+"%",n=(a.pageY-this.offsetTop)/(s*o/100)+"%";Object.assign(e.style,{backgroundPosition:i+" "+n,backgroundSize:t+"px"})}}else touch=!0;e.onmouseleave=function(t){Object.assign(e.style,{backgroundPosition:"center",backgroundSize:"contain"})}},a.src=t}))}else console.log("No such document!"),$(".main").html("Not found!")})).catch((e=>{console.log("Error getting document Item:",e),$(".main").html("Not found!")})):$(".main").html("Not found!"),$("#b_back").click((function(){0===document.referrer.indexOf(location.protocol+"//"+location.host)&&history.length>1?window.history.back():document.location.href="../"})),$(".img").click((function(){enlarge(this)})),$(".img1").click((function(){enlarge(this)})),$("#b_image_close").click((function(){$(".image_enlarge").css("backgroundImage",""),$(".image_enlarge").css("visibility","hidden"),$(".image_enlarge").css("z-index","-50")})),firebase.auth().onAuthStateChanged((async e=>{e&&(uid=e.uid,db.collection("Users").doc(uid).get().then((async e=>{e.exists?(storage_user=e.data(),$("#b_user").children("i").attr("class",""),$("#i_profile").attr("src",storage_user.photo)):console.log("No such document!")})).catch((e=>{console.log("Error getting document Users",e)})))}));
